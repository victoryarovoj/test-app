<script type="text/javascript" language="javascript">

    $("#saveCertificateKeyAgreement").click(function() {
        sjwsa.Enviroment.getCertificateInBase64("keyAgreement").then(function(jsonObject) {
            var uintArray = toByteArray(jsonObject.base64Data);
            saveAs(new Blob([uintArray]), ".crt");
        })
    });

    onKeyAgreementCertInfoTabHandler = function () {
        //$("#certInfoContent").hide();
        sjwsa.Enviroment.getCertificateInfo("keyAgreement").then(function (jsonObject) {
            //var jsonText = JSON.stringify(jsonObject, null, 2);
            if (!(jsonObject instanceof Object && Object.keys(jsonObject).length > 0 )) {
                $("#kaCertInfoContent").hide();
                return;
            };

            $("#kaCertInfoContent").show();
            $("#saveCertificateKeyAgreement").prop("disabled", false);
            var ownerInfo = jsonObject.ownerCertificateInfo.value;
            var issuerInfo = jsonObject.issuerCertificateInfo.value;
            var publicKeyInfo = jsonObject.publicKeyCertificateInfo.value;
            var extCertInfo = jsonObject.extensionsCertificateInfo.value;
            var extPersonalData = extCertInfo.personalData.value;

            var dl = $("#kaOwnerInfoBodyList");
            dl.empty();
            for (var i in ownerInfo) {
                if (ownerInfo[i].value != null) {
                    dl.append($("<dt></dt>").text(ownerInfo[i].description));
                    dl.append($("<dd></dd>").text(ownerInfo[i].value));
                }
            }
            for (var i in extPersonalData) {
                if (i === "drfou" || i === "passport" || i === "eddrun") {
                    if (extPersonalData[i].value != null) {
                        dl.append($("<dt></dt>").text(extPersonalData[i].description));
                        dl.append($("<dd></dd>").text(extPersonalData[i].value));
                    }
                }
            }

            dl = $("#kaIssuerInfoBodyList");
            dl.empty();
            for (var i in issuerInfo) {
                if (issuerInfo[i].value != null) {
                    dl.append($("<dt></dt>").text(issuerInfo[i].description));
                    dl.append($("<dd></dd>").text(issuerInfo[i].value));
                }
            }

            dl = $("#kaPublicKeyInfoBodyList");
            dl.empty();
            for (var i in publicKeyInfo) {
                if (publicKeyInfo[i].value != null) {
                    dl.append($("<dt></dt>").text(publicKeyInfo[i].description));
                    dl.append($("<dd></dd>").text(publicKeyInfo[i].value));
                }
            }

            dl = $("#kaCertInfoBodyList");
            dl.empty();
            dl.append($("<dt></dt>").text(jsonObject.certificateSerialNumber.description));
            dl.append($("<dd></dd>").text(jsonObject.certificateSerialNumber.value));
            dl.append($("<dt></dt>").text(jsonObject.notBefore.description));
            dl.append($("<dd></dd>").text(jsonObject.notBefore.value));
            dl.append($("<dt></dt>").text(jsonObject.notAfter.description));
            dl.append($("<dd></dd>").text(jsonObject.notAfter.value));
            dl.append($("<dt></dt>").text(extCertInfo.isReinforced.description));
            dl.append($("<dd></dd>").text(extCertInfo.isReinforced.value == "true" ? i18next.t("yesUCase") : i18next.t("noUCase")));
        })
    };

    $(document).ready(function() {

        function localizeRoutine() {
            $("#kaOwnerInfoTitle").text(i18next.t("cert:ownerInfoTitle"));
            $("#kaIssuerInfoTitle").text(i18next.t("cert:issuerInfoTitle"));
            $("#kaPublicKeyInfoBodyListTitle").text(i18next.t("cert:publicKeyInfoBodyListTitle"));
            $("#saveCertificateKeyAgreement").text(i18next.t("cert:saveCertificate"));
        }

        i18next.on('languageChanged', function (lng) {
            localizeRoutine();
        });

        localizeRoutine();
    })
</script>

<div class="mtb-default" id="kaCertInfoContent">
    <div class="text-right">
        <button type="button" class="btn btn-default mtb-default" id="saveCertificateKeyAgreement" disabled></button>
    </div>
    <div class="panel panel-default">
        <div class="panel-body">
            <dl class="dl-horizontal" id="kaCertInfoBodyList"></dl>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading">
            <span id="kaOwnerInfoTitle"></span>
        </div>
        <div class="panel-body">
            <dl class="dl-horizontal" id="kaOwnerInfoBodyList"></dl>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading">
            <span id="kaIssuerInfoTitle"></span>
        </div>
        <div class="panel-body">
            <dl class="dl-horizontal" id="kaIssuerInfoBodyList"></dl>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading">
            <span id="kaPublicKeyInfoBodyListTitle"></span>
        </div>
        <div class="panel-body">
            <dl class="dl-horizontal" id="kaPublicKeyInfoBodyList"></dl>
        </div>
    </div>
</div>
